---
import Moon from "@/icons/moon.astro";
import Sun from "@/icons/sun.astro";
---

<button id="theme-toggle" type="button" aria-label="Toggle theme">
  <Sun class="sun" size={18} />
  <Moon class="moon" size={18} />
</button>

<style>
  button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    padding: 0;
    border: none;
    border-radius: 4px;
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    transition: color 0.2s ease;
  }

  button:hover {
    color: var(--text);
  }

  button {
    position: relative;
  }

  :global(.sun),
  :global(.moon) {
    position: absolute;
    transition:
      opacity 0.3s ease,
      transform 0.3s ease;
  }

  /* Light mode: show moon (to switch to dark) */
  :global(:root:not([data-theme="dark"]) .sun) {
    opacity: 0;
    transform: rotate(-90deg) scale(0.5);
  }

  :global(:root:not([data-theme="dark"]) .moon) {
    opacity: 1;
    transform: rotate(0) scale(1);
  }

  /* Dark mode: show sun (to switch to light) */
  :global([data-theme="dark"] .sun) {
    opacity: 1;
    transform: rotate(0) scale(1);
  }

  :global([data-theme="dark"] .moon) {
    opacity: 0;
    transform: rotate(90deg) scale(0.5);
  }
</style>

<script>
  function setupThemeToggle() {
    const toggle = document.getElementById("theme-toggle");

    toggle?.addEventListener("click", () => {
      const current = document.documentElement.dataset.theme;
      const next = current === "dark" ? "light" : "dark";
      document.documentElement.dataset.theme = next;
      localStorage.setItem("theme", next);
    });
  }

  setupThemeToggle();
  document.addEventListener("astro:after-swap", setupThemeToggle);
</script>
