---
import { Briefcase } from "lucide-astro";
import Base from "../../layouts/Base.astro";

export const prerender = true;

const PROJECTS_REPO = "AbhinRustagi/projects";

interface ProjectMeta {
  title: string;
  date: string;
  slug: string;
  path: string;
  description?: string;
  tags: string[];
  thumbnail?: string;
  published: boolean;
}

const res = await fetch(
  `https://raw.githubusercontent.com/${PROJECTS_REPO}/main/index.json`
);
const index: ProjectMeta[] = await res.json();

const projects = index
  .filter((p) => p.published)
  .sort((a, b) => new Date(b.date).valueOf() - new Date(a.date).valueOf());
---

<Base
  title="Projects - Abhin Rustagi"
  description="Selected projects and case studies from my work over the years with different startups."
>
  <section>
    <div class="container section-wrapper">
      <h1 class="section-title">
        <Briefcase class="section-title-icon" />Projects
      </h1>
      <p class="text-muted desc">
        Projects I've worked on for fun or as a side hustle. Check out the
        Github source for these writeups <a
          href="https://github.com/AbhinRustagi/projects">here</a
        >.
      </p>

      {
        projects.length === 0 ? (
          <p class="empty text-muted">No projects yet. Check back soon.</p>
        ) : (
          <div class="timeline">
            {projects.map((project, i) => (
              <div
                class={`timeline-item animate-in animate-in-delay-${Math.min(i + 1, 4)}`}
              >
                <div class="timeline-content">
                  <a href={`/projects/${project.slug}`} class="work-link">
                    {project.title}
                  </a>
                  {project.description && (
                    <p class="work-desc">{project.description}</p>
                  )}
                </div>
                <span class="timeline-date">
                  {new Date(project.date).toLocaleDateString("en-US", {
                    month: "short",
                    year: "2-digit",
                    day: "numeric",
                  })}
                </span>
              </div>
            ))}
          </div>
        )
      }
    </div>
  </section>
</Base>

<style>
  .desc {
    margin-bottom: var(--space-xl);
  }

  .page-header {
    margin-bottom: var(--space-xl);
  }

  .page-header h1 {
    margin-bottom: var(--space-sm);
  }

  .empty {
    padding: var(--space-xl) 0;
  }

  .work-link {
    font-family: var(--font-sans);
    font-weight: 500;
    font-size: 1rem;
    color: var(--text);
  }

  .work-link:hover {
    color: var(--accent);
  }

  .work-desc {
    margin: var(--space-xs) 0 0;
    font-size: 0.9375rem;
    color: var(--text-muted);
  }

  .work-tech {
    margin: var(--space-xs) 0 0;
    font-size: 0.8125rem;
    color: var(--text-muted);
    opacity: 0.8;
  }
</style>
